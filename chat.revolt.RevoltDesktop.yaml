app-id: chat.revolt.RevoltDesktop
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '22.08'
sdk-extensions:
- org.freedesktop.Sdk.Extension.node16
command: run.sh
separate-locales: false
finish-args:
  # Xorg access for graphics
- --share=ipc
- --socket=x11
  # Required to provide Call functionality
- --socket=pulseaudio
- --device=all
  # Network access
- --share=network
  # Local filesystem
- --filesystem=xdg-documents:ro
- --filesystem=xdg-pictures:ro
- --filesystem=xdg-videos:ro

  # Required for notifications in various desktop environments
- --talk-name=org.freedesktop.Notifications
- --talk-name=org.kde.StatusNotifierWatcher
  # Required for advanced input methods e.g. writing CJK languages
- --talk-name=org.freedesktop.portal.Fcitx

modules:
  # Build and install revolt
- name: revolt
  buildsystem: simple
  build-options:
    append-path: /usr/lib/sdk/node16/bin
    env:
      npm_config_nodedir: /usr/lib/sdk/node16
  sources:

  - type: file
    url: https://github.com/revoltchat/desktop/releases/download/v1.0.6/Revolt-1.0.6.AppImage
    sha256: 77032c92ecd147b5b8e696540e6e7b0e9c158f9426cde3dd61b0c2ea47108bfa
  - type: file
    dest-filename: run.sh
    path: ./extras/run.sh
  - type: file
    path: ./extras/chat.revolt.RevoltDesktop.desktop
  - type: file
    path: ./chat.revolt.RevoltDesktop.metainfo.xml
  - type: file
    path: ./extras/icon256.png

  build-commands:
  - install -Dm775 run.sh /app/bin/run.sh
  - install -D chat.revolt.RevoltDesktop.desktop -t /app/share/applications/
  - install -Dm644 $FLATPAK_ID.metainfo.xml -t /app/share/metainfo/
  - install -D icon256.png /app/share/icons/hicolor/256x256/apps/chat.revolt.RevoltDesktop.png
  - chmod +x Revolt-*.AppImage
  - ./Revolt-*.AppImage --appimage-extract
  - mv squashfs-root /app/bin/revolt
